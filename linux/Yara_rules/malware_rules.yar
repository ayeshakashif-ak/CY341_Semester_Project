rule memory_resident_malware
{
    meta:
        description = "Detects code patterns common in injected shellcode"
        author = "Ayesha"
        category = "Memory injection"

    strings:
        $shellcode = { 90 90 90 E8 ?? ?? ?? ?? 83 C4 04 }  // NOP sled + CALL + cleanup
        $heap_string = "VirtualAlloc" ascii
        $exec_string = "CreateRemoteThread" ascii

    condition:
        $shellcode or (all of them)
}
